<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the GSPE R Package • FPBKPack2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the GSPE R Package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-11414212-0"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-11414212-0');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FPBKPack2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ShinyVignette.html">Using the GSPE Shiny App</a>
    </li>
    <li>
      <a href="../articles/my-vignette.html">Using the GSPE R Package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/highamm/FPBKPack2">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using the GSPE R Package</h1>
                        <h4 class="author">Matt Higham</h4>
            
            <h4 class="date">2019-07-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/highamm/FPBKPack2/blob/master/vignettes/my-vignette.Rmd"><code>vignettes/my-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>my-vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The purpose of this vignette is to illustrate how to use the GSPE <code>R</code> Package for moose survey data, both with and without a separate sightability study. There are three primary sections, each building off the previous section. Throughout the Vignette, a simulated moose survey is used as an example. Though some of the documentation references moose specifically, the package can be used for many ecological studies with count data collected on a finite number of sites.</p>
<ul>
<li>Section 1 shows how to obtain a population prediction assuming perfect detection.</li>
<li>Section 2 shows how to obtain a population prediction assuming constant detection across all sites.</li>
<li>Section 3 shows how to obtain a population prediction using radiocollar data with the possibility of site covariates useful for predicting detection.</li>
</ul>
<hr>
</div>
<div id="section-1-perfect-detection" class="section level2">
<h2 class="hasAnchor">
<a href="#section-1-perfect-detection" class="anchor"></a>Section 1: Perfect Detection</h2>
<p>As mentioned above, we will use a simulated moose survey. Though we have sightability trials for this particular data set, suppose first that we want to assume perfect detection. Like many moose data sets, the sites are stratified into a “High” strata and a “Low” strata. Let’s load the <code>FPBKPack2</code> library and take a look at the data set and at an accompanying map of the stratification.</p>
<p>The easiest way to install the package from GitHub is to use the <code>install_git</code> function in the <code>devtools</code> library.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## install the package first with devtools
## install.packages("devtools")

## devtools::install_git("https://github.com/highamm/FPBKPack2.git")
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(FPBKPack2)

simdf &lt;-<span class="st"> </span>vignettecount

pander<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(simdf[ ,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Xcoords"</span>, <span class="st">"Ycoords"</span>, <span class="st">"Moose"</span>,
  <span class="st">"CountPred"</span>, <span class="st">"Stratum"</span>)]))</code></pre></div>
<table class="table">
<colgroup>
<col width="13%">
<col width="13%">
<col width="11%">
<col width="16%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">Xcoords</th>
<th align="center">Ycoords</th>
<th align="center">Moose</th>
<th align="center">CountPred</th>
<th align="center">Stratum</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0.3158</td>
<td align="center">0.3158</td>
<td align="center">9</td>
<td align="center">4.302</td>
<td align="center">Low</td>
</tr>
<tr class="even">
<td align="center">0.7895</td>
<td align="center">0.1579</td>
<td align="center">23</td>
<td align="center">1.901</td>
<td align="center">Low</td>
</tr>
<tr class="odd">
<td align="center">0.8947</td>
<td align="center">0.1579</td>
<td align="center">NA</td>
<td align="center">2.507</td>
<td align="center">Low</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">NA</td>
<td align="center">2.521</td>
<td align="center">Low</td>
</tr>
<tr class="odd">
<td align="center">0.9474</td>
<td align="center">0.5263</td>
<td align="center">0</td>
<td align="center">3.693</td>
<td align="center">Low</td>
</tr>
<tr class="even">
<td align="center">0.3684</td>
<td align="center">0.1053</td>
<td align="center">NA</td>
<td align="center">3.086</td>
<td align="center">High</td>
</tr>
</tbody>
</table>
<p>The title of the data set is <code>simdf</code>.</p>
<p>One aspect of the data set to note is that all of the counts on unsampled sites are given as <code>NA</code> values. By default, if uploading an Excel spreadsheet or a .csv file into <code>R</code>, any blank cells are converted to <code>NA</code> values. So, unsampled sites should have <code>NA</code> count values (not <code>-9999</code> or <code>NotSampled</code>, etc.) before using the package functions.</p>
<p>We can also look at a map of where sites were sampled:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)

<span class="co">#minxdist &lt;- min(dist(simdf$Xcoords)[dist(simdf$Ycoords) != 0])</span>
<span class="co">#minydist &lt;- min(dist(simdf$Xcoords)[dist(simdf$Ycoords) != 0])</span>
simdf<span class="op">$</span>samplingindicator &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(simdf<span class="op">$</span>Moose))
<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(simdf<span class="op">$</span>samplingindicator)[<span class="dv">1</span>] &lt;-<span class="st"> "Sampled"</span>
<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(simdf<span class="op">$</span>samplingindicator)[<span class="dv">2</span>] &lt;-<span class="st"> "Unsampled"</span>

p3 &lt;-<span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> simdf, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> Xcoords, <span class="dt">y =</span> Ycoords,
  <span class="dt">colour =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(samplingindicator))) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_colour_viridis_d</a></span>(<span class="st">"Sampling Indicator"</span>, <span class="dt">begin =</span> <span class="fl">0.2</span>,
    <span class="dt">end =</span> <span class="fl">0.9</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"X Coordinates"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Y Coordinates"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Grid of Sites Showing Which Were Sampled"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(p3)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="my-vignette_files/figure-html/unnamed-chunk-3-1.png" alt=" Stratifiacation" width="576"><p class="caption">
Stratifiacation
</p>
</div>
<p>And we can examine a grid of the stratification structure:</p>
<p><img src="my-vignette_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<hr>
<div id="r-shiny-app" class="section level4">
<h4 class="hasAnchor">
<a href="#r-shiny-app" class="anchor"></a>R Shiny App</h4>
<p>Much of the functionality of this package will be made available in an <code>R Shiny</code> app to be developed before the end of summer of 2019. The following Vignette shows how to use the package in <code>R</code> or <code>RStudio</code> directly. See the <code>Shiny</code> vignette if interested in using the package through the <code>Shiny</code> app.</p>
<hr>
</div>
<div id="package-functions" class="section level4">
<h4 class="hasAnchor">
<a href="#package-functions" class="anchor"></a>Package Functions</h4>
<p>There are five main functions that a user would call to obtain the population prediction. They are:</p>
<ul>
<li>
<code>slmfit</code>(Spatial Linear Model fit), used to fit covariance parameter estimates and obtain estimated regression coefficients,</li>
<li>
<code>predict</code>, used to do the spatial prediction,</li>
<li>
<code>FPBKoutput</code> to format the results,</li>
<li>
<code>multistrat</code> to combine <code>slmfit</code>, <code>predict</code>, and <code>FPBKoutput</code> when fitting the model to multiple strata, and</li>
<li>
<code>get_reportdoc</code> to obtain a report similar to the Winfonet report.</li>
</ul>
<p>Most of the remainder of the functions in the package are helper functions called within the four main functions above.</p>
<hr>
</div>
<div id="the-slmfit-function" class="section level4">
<h4 class="hasAnchor">
<a href="#the-slmfit-function" class="anchor"></a>The <code>slmfit</code> Function</h4>
<p><code>slmfit</code> has the most user inputs, including:</p>
<ul>
<li>
<code>formula</code>, an <code>R</code> formula in the form <code>response ~ predictor1 +  predictor2 + ...</code>
</li>
<li>
<code>data</code>, the full data set containing both sampled and unsampled observations, including the predictors, the response, and the spatial coordinates.</li>
<li>
<code>xcoordcol</code>, the name of the column containing x-coordinates, in quotes.</li>
<li>
<code>ycoordcol</code>, the name of the column containing y-coordinates, in quotes.</li>
<li>
<code>CorModel</code>, the covariance structure, defaulting to <code>"Exponential"</code> with <code>"Gaussian"</code> and <code>"Spherical"</code> as other possiblities.</li>
<li>
<code>areacol</code>, the name of the column with site areas. If omitted, sites are assumed to have equal area.</li>
<li>
<code>coordtype</code>, either <code>TM</code> by default which results in the package not modifying the coordinates or <code>LatLon</code> for latitude / longitude coordinates which results in conversion to <code>TM</code> coordinates within the package.</li>
<li>a few other optional arguments.</li>
</ul>
<p>The <code>formula</code> input allows the user to put in categorical or continuous covariates that are thought to be associated with site count totals (eg. habitat covariates). For the Togiak March analysis, we do not have any such covariates so the formula used is <code>response ~ 1</code>. Throughout the package, we try to keep as much of the syntax as similar as possible to <code>R</code>’s <code>lm</code> function in the hopes that a new user already familiar with <code>lm</code> can more easily use the package.</p>
<p>Let’s first begin by obtaining a prediction for the population total in the high stratum. For this data set, the coordinates have already been converted from Latitude/Longitude coordinates into TM coordinates. For the simulated data set, the input would look like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">highdf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(simdf, Stratum <span class="op">==</span><span class="st"> "High"</span>)
slmobj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slmfit.html">slmfit</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
  <span class="dt">data =</span> highdf,
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>,
  <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">CorModel =</span> <span class="st">"Exponential"</span>,
  <span class="dt">areacol =</span> <span class="st">"Area"</span>)</code></pre></div>
<p>The <code>slmobj</code> has <strong>a lot</strong> of information within it. We can use the <code>summary</code> function to obtain some of the most pertinent information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(slmobj)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; Moose ~ 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -3.8975 -3.0225  0.1025  2.7275  8.6025 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;      Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; [1,]   3.8975     0.9999   3.898  0.00025 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Covariance Parameters:</span>
<span class="co">#&gt;              Exponential Model</span>
<span class="co">#&gt; Nugget                10.60941</span>
<span class="co">#&gt; Partial Sill       74912.62873</span>
<span class="co">#&gt; Range              37324.30856</span></code></pre></div>
<p>When <code>areacol</code> is included, then the spatial prediction utilizes densities, not counts. So, the coefficient estimate is the estimate the mean density in the high stratum. The densities are transformed back to counts in the <code>predict</code> function, which is described next.</p>
<hr>
</div>
<div id="the-predict-function" class="section level4">
<h4 class="hasAnchor">
<a href="#the-predict-function" class="anchor"></a>The <code>predict</code> Function</h4>
<p>The user then inputs the object created by <code>slmfit</code> to the <code>predict</code> function. The <code>predict</code> function has the following arguments:</p>
<ul>
<li>
<code>object</code>, a named model object from <code>slmfit</code>.</li>
<li>
<code>FPBKcol</code>, the name of the column in the data set with prediction weights. If omitted, the <code>predict</code> function predicts the population total.</li>
<li>a few other arguments.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">predobj &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="dt">object =</span> slmobj)</code></pre></div>
<p>I’ve left the <code>FPBKcol</code> out for this example, resulting in a prediction for the population total. The <code>predict</code> function contains the prediction for the population total, the prediction variance, and the data set that the user input to <code>slmfit</code> with the following columns appended:</p>
<ul>
<li>
<code>response_pred</code>, the site-by-site predictions.</li>
<li>
<code>response_predvar</code>, the site-by-site prediction variances.</li>
<li>
<code>response_sampind</code>, an indicator column of which sites were sampled.</li>
<li>
<code>response_muhat</code>, a column of means for the density at each site.</li>
</ul>
<p>Some of these features are summarized in the following output function that generates a mini-report. However, having the appended data set available to the user can be beneficial to anyone who might want to obtain their own specific summary statistics, graphics, etc. using <code>R</code> or other software like GIS.</p>
<hr>
</div>
<div id="the-fpbkoutput-function" class="section level4">
<h4 class="hasAnchor">
<a href="#the-fpbkoutput-function" class="anchor"></a>The <code>FPBKoutput</code> Function</h4>
<p>The user can run the <code>FPBKoutput</code> function (Finite Population Block Kriging output). I’ve tried to structure much of the report output to be as similar to the WinfoNet output as possible. If using the package through the future <code>R Shiny</code> app, this report is output from the app in addition to a .csv file with the data set from <code>predict</code>. Inputs to <code>FPBKoutput</code> include:</p>
<ul>
<li>
<code>pred_info</code>, the object generated from <code>predict</code>.</li>
<li>
<code>conf_level</code>, the desired confidence level for prediction intervals. By default, the output returns 80%, 90%, and 95% prediction intervals.</li>
<li>
<code>get_krigmap</code>, <code>get_sampdetails</code>, <code>get_variogram</code>, are options to get a plot of the predictions, get some tables with details of the sampling, get a variogram of the residuals with the fitted model, and get an HTML report, respectively. These are set to <code>FALSE</code> by default.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">outputobj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FPBKoutput.html">FPBKoutput</a></span>(<span class="dt">pred_info =</span> predobj,
  <span class="dt">conf_level =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>),
  <span class="dt">get_krigmap =</span> <span class="ot">TRUE</span>, <span class="dt">get_sampdetails =</span> <span class="ot">TRUE</span>,
  <span class="dt">get_variogram =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>We can get the data set with site-by-site predictions as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred_df &lt;-<span class="st"> </span>outputobj<span class="op">$</span>predvals
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(pred_df)</code></pre></div>
<p>The column with the predictions is generally named <code>name_of_count_variable_pred</code>. We can get a report from the outputobj as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_reportdoc.html">get_reportdoc</a></span>(outputobj)</code></pre></div>
<hr>
</div>
<div id="a-couple-of-extra-notes" class="section level4">
<h4 class="hasAnchor">
<a href="#a-couple-of-extra-notes" class="anchor"></a>A couple of extra notes</h4>
<p>The sites in the simulatd data set have equal area, so including area is not important or necessary. If sites have very different areas, then it is important to specify the column that has the areas in the <code>areacol</code> argument. Note that since all of the areas are exactly the same for the sites, we get the same prediction for the total and the same standard error whether area is included or not.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">slmobj_noarea &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slmfit.html">slmfit</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
  <span class="dt">data =</span> highdf,
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>,
  <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">CorModel =</span> <span class="st">"Exponential"</span>,
  <span class="dt">areacol =</span> <span class="ot">NULL</span>)
predobj_noarea &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="dt">object =</span> slmobj_noarea)
predobj<span class="op">$</span>FPBK_Prediction
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 1080.689</span>
<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(predobj<span class="op">$</span>PredVar)
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 81.74994</span>
predobj_noarea<span class="op">$</span>FPBK_Prediction
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 1080.689</span>
<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(predobj_noarea<span class="op">$</span>PredVar)
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 81.74994</span></code></pre></div>
<p>Secondly, there is a choice of how to include stratification in the estimator. In the current WinfoNet estimator, strata are treated completely separately in the predictions. In other words, we get a prediction, covariance parameter estimates, etc. for the low stratum and a prediction, covariance parameter estimates, etc. for the high stratum. Our total prediction is simply the sum of the stratum predictions. The extra assumption that we make is that there is no <strong>cross-correlation</strong> across the strata.</p>
<hr>
</div>
<div id="the-multistrat-function" class="section level4">
<h4 class="hasAnchor">
<a href="#the-multistrat-function" class="anchor"></a>The <code>multistrat</code> Function</h4>
<p>If implementing this method, we would only need to use a single function <code>multistrat</code> that has all of the necessary arguments bundled together. In addition to the arguments described above, <code>multistrat</code> has a <code>stratcol</code> argument, in which the user puts the name of the column with the stratification variable. <code>multistrat</code> then assumes that the user wants to fit a separate covariance model for each stratum and predicts the total for the entire region of interest as well as the totals for each stratum.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multiobj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/multistrat.html">multistrat</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
  <span class="dt">data =</span> simdf,
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>, <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">stratcol =</span> <span class="st">"Stratum"</span>)</code></pre></div>
<p>We then can use the <code>get_reportdoc</code> function to obtain a report in html:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_reportdoc.html">get_reportdoc</a></span>(multiobj)</code></pre></div>
<p>We can also obtain the data frame with site-by-site predictions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multipred_df &lt;-<span class="st"> </span>multiobj<span class="op">$</span>predvals
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(multipred_df)</code></pre></div>
<p>Another choice is to include stratification as a covariate in the <code>formula</code> part of the linear model. The extra assumption that we would make using this method is that the spatial autocorrelation structure is similar in each of the strata but that the means of the strata are different. In the case of many of the Alaskan moose data sets, this assumption does not seem to be reasonable, as the high stratum has substantially more variability and more spatial autocorrelation than the low stratum does. However, if this seems reasonable in other data sets, the code for <code>slmfit</code> would be:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">slmobj_cov &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slmfit.html">slmfit</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span>Stratum, ## add 
  ## marchstrat as a predictor
  <span class="dt">data =</span> simdf, ## change the data set to have all sites
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>,
  <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">CorModel =</span> <span class="st">"Exponential"</span>,
  <span class="dt">areacol =</span> <span class="st">"Area"</span>)</code></pre></div>
<p>Note that, for either method (fitting each stratum separately or using stratum as a covariate in the linear model), the user is able to supply more than two stratum if desired.</p>
<hr>
</div>
</div>
<div id="section-2-constant-detection-across-sites" class="section level2">
<h2 class="hasAnchor">
<a href="#section-2-constant-detection-across-sites" class="anchor"></a>Section 2: Constant Detection Across Sites</h2>
<p>If we make the assumption that detection is approximately equal across all sites in the study region, then we can input an estimate of mean detection and its standard error into <code>predict</code> to obtain a prediction for the population total adjusted for mean detection. The estimate of mean detection and its standard error can be obtained from a variety of methods (radiocollars, double sampling, etc.). The package performs block kriging (spatial prediction) using the observed counts and then adjusts for detection in <code>predict</code>, obtaining a prediction variance using the delta method.</p>
<p>To add arguments for this adjustment in the package, there is an argument to <code>predict</code> called <code>detinfo</code>. By default, <code>detinfo = c(1, 0)</code>, indicating perfect detection (<code>1</code>) and no variability about that estimate for detection (<code>0</code>). Suppose that we estimate detection to be <code>0.7</code> with a standard error of <code>0.06</code>. For the high stratum in the simulated data set, the code to adjust for detection in this way is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">slmobj_det &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slmfit.html">slmfit</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
  <span class="dt">data =</span> highdf,
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>,
  <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">CorModel =</span> <span class="st">"Exponential"</span>,
  <span class="dt">areacol =</span> <span class="st">"Area"</span>)

## add detinfo argument here
meandet &lt;-<span class="st"> </span><span class="fl">0.7</span>; sedet &lt;-<span class="st"> </span><span class="fl">0.06</span>
predobj_det &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="dt">object =</span> slmobj_det,
  <span class="dt">detinfo =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(meandet, sedet))
predobj_det<span class="op">$</span>FPBK_Prediction
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 1543.841</span>
<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(predobj_det<span class="op">$</span>PredVar)
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 150.5765</span></code></pre></div>
<p>Note that the code for <code>slmfit</code> remains the same while there is one additional argument to <code>predict</code>. As expected, our prediction for the population total increases when we take into account imperfect detection. Additionally, imperfect detection increases our uncertainty about the prediction, so our prediction error also increases when we include imperfect detection.</p>
<p>To obtain an estimator for the entire region, fitting covariance models for each stratum separately, we would again use the <code>multistrat</code> and specify the mean and standard error for detection as an argument to <code>multistrat</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multiobjdetection &lt;-<span class="st"> </span><span class="kw"><a href="../reference/multistrat.html">multistrat</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
  <span class="dt">data =</span> simdf,
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>, <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">stratcol =</span> <span class="st">"Stratum"</span>,
  <span class="dt">detinfo =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.7</span>, <span class="fl">0.06</span>))</code></pre></div>
<p>For either case, the <code>get_reportdoc</code> function can still be used to obtain an html report. We can also still find the data set with site-by-site predictions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## High Stratum only:
output_objdet &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FPBKoutput.html">FPBKoutput</a></span>(<span class="dt">pred_info =</span> predobj_det)
preddf &lt;-<span class="st"> </span>output_objdet<span class="op">$</span>predvals
<span class="kw"><a href="../reference/get_reportdoc.html">get_reportdoc</a></span>(output_objdet)

## Total: both stratum
preddf_strat &lt;-<span class="st"> </span>multiobjdetection<span class="op">$</span>predvals
<span class="kw"><a href="../reference/get_reportdoc.html">get_reportdoc</a></span>(preddf_strat)</code></pre></div>
<hr>
</div>
<div id="section-3-estimating-detection-using-logistic-regression-on-radiocollar-data" class="section level2">
<h2 class="hasAnchor">
<a href="#section-3-estimating-detection-using-logistic-regression-on-radiocollar-data" class="anchor"></a>Section 3: Estimating Detection Using Logistic Regression on Radiocollar Data</h2>
<p>For some data sets, the assumption of constant detection across sites might seem reasonable. If we do not have any habitat covariates that are strongly associated with detection in the sightability trials, then we might assume constant detection. However, for the purpose of this vignette, suppose that we would like to estimate detection using a couple of covariates, named <code>DetPred1</code> and <code>DetPred2</code>.</p>
<p>Let’s first examine our sightability data set (which contains the data on the sightability trials):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pander<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(vignettedetection))</code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="15%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center">X</th>
<th align="center">Detected</th>
<th align="center">DetPred1</th>
<th align="center">DetPred2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0.836</td>
<td align="center">1.223</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">0</td>
<td align="center">0.6441</td>
<td align="center">-1.387</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">0.1143</td>
<td align="center">-1.281</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">0</td>
<td align="center">0.6889</td>
<td align="center">-0.7121</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">0.8233</td>
<td align="center">1.349</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">0.8571</td>
<td align="center">-1.311</td>
</tr>
</tbody>
</table>
<p>In order to get detection estimates using logistic regression, we use the <code>get_detection</code> function within this package. The <code>get_detection</code> function only has three arguments:</p>
<ul>
<li>
<code>formula</code>, an R formula of the form <code>response ~ pred1 + pred2 + ...</code>, where the <code>response</code> is the name of the column with the sightability successes and failures, and <code>pred1</code>, <code>pred2</code>, etc. are the predictors thought to be useful for predicting detection.</li>
<li>
<code>data</code> is the name of the data set with the sightability trials.</li>
<li>
<code>varmethod</code> is the method used to obtain the variance of the detection estimates, either <code>"Bootstrap"</code> by default or <code>"Delta"</code>.</li>
</ul>
<p>We see that the name of the column in the <code>vignettedetection</code> data set with the response is called <code>Detected</code>. Therefore, to get the detection information needed, we can run</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sightability_info &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_detection.html">get_detection</a></span>(<span class="dt">formula =</span> Detected <span class="op">~</span>
<span class="st">    </span>DetPred1 <span class="op">+</span><span class="st"> </span>DetPred2,
  <span class="dt">data =</span> vignettedetection,
  <span class="dt">varmethod =</span> <span class="st">"Bootstrap"</span>)</code></pre></div>
<p>The object <code>det_info</code> contains the information necessary for <code>slmfit</code>, <code>predict</code> and <code>FPBKoutput</code> to construct the prediction for the population total, adjusted for different detection across sites. The only extra argument is needed in <code>slmfit</code>. The argument <code>detectionobj</code> is, by default set to <code>NULL</code>. If we add the <code>sightability_info</code> output as its argument and proceed with <code>predict</code> and <code>FPBKoutput</code> with no other differences, we obtain the prediction adjusted for imperfect detection.</p>
<p>The only other aspect of the functions to note here is that the data set in <code>slmfit</code> <strong>MUST</strong> have columns with the same predictors as those used in <code>get_detection</code>. The names of these columns must be exactly the same in both data sets. For example, if I named the willow variable <code>DetPred1</code> in the sightability data set but <code>detectionpredictor1</code> in the full data set, the package does not know that these are actually referring to the same variable. The data set <code>simdf</code> includes columns for <code>DetPred1</code> and <code>DetPred2</code> within the data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pander<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(simdf[ ,<span class="dv">2</span><span class="op">:</span><span class="dv">8</span>]))</code></pre></div>
<table class="table">
<colgroup>
<col width="13%">
<col width="13%">
<col width="10%">
<col width="16%">
<col width="15%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center">Xcoords</th>
<th align="center">Ycoords</th>
<th align="center">Moose</th>
<th align="center">CountPred</th>
<th align="center">DetPred1</th>
<th align="center">DetPred2</th>
<th align="center">Stratum</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0.3158</td>
<td align="center">0.3158</td>
<td align="center">9</td>
<td align="center">4.302</td>
<td align="center">0.04218</td>
<td align="center">-0.7164</td>
<td align="center">Low</td>
</tr>
<tr class="even">
<td align="center">0.7895</td>
<td align="center">0.1579</td>
<td align="center">23</td>
<td align="center">1.901</td>
<td align="center">0.9237</td>
<td align="center">1.646</td>
<td align="center">Low</td>
</tr>
<tr class="odd">
<td align="center">0.8947</td>
<td align="center">0.1579</td>
<td align="center">NA</td>
<td align="center">2.507</td>
<td align="center">0.2561</td>
<td align="center">-0.09647</td>
<td align="center">Low</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">NA</td>
<td align="center">2.521</td>
<td align="center">0.3524</td>
<td align="center">-1.82</td>
<td align="center">Low</td>
</tr>
<tr class="odd">
<td align="center">0.9474</td>
<td align="center">0.5263</td>
<td align="center">0</td>
<td align="center">3.693</td>
<td align="center">0.06458</td>
<td align="center">0.8484</td>
<td align="center">Low</td>
</tr>
<tr class="even">
<td align="center">0.3684</td>
<td align="center">0.1053</td>
<td align="center">NA</td>
<td align="center">3.086</td>
<td align="center">0.4624</td>
<td align="center">-1.195</td>
<td align="center">High</td>
</tr>
</tbody>
</table>
<p>So, let’s obtain a prediction for the high stratum first, adjusting for imperfect detection using logistic regression.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">slmobj_dethigh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slmfit.html">slmfit</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
  <span class="dt">data =</span> highdf,
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>,
  <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">CorModel =</span> <span class="st">"Exponential"</span>,
  <span class="dt">estmethod =</span> <span class="st">"ML"</span>,
  <span class="dt">areacol =</span> <span class="st">"Area"</span>,
  <span class="dt">detectionobj =</span> sightability_info)

predobj_dethigh &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="dt">object =</span> slmobj_dethigh)
predobj_dethigh<span class="op">$</span>FPBK_Prediction
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 1510.328</span>
output_sightability &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FPBKoutput.html">FPBKoutput</a></span>(<span class="dt">pred_info =</span> predobj_dethigh)
<span class="co">#&gt;      Prediction SE(Prediction)</span>
<span class="co">#&gt; [1,]   1510.328       184.2228</span>
<span class="co">#&gt;      Lower Bound Upper Bound Proportion of Mean</span>
<span class="co">#&gt; 80 %        1274        1746               0.16</span>
<span class="co">#&gt; 90 %        1207        1813               0.20</span>
<span class="co">#&gt; 95 %        1149        1871               0.24</span>
<span class="co">#&gt;      Numb. Sites Sampled Total Numb. Sites Animals Counted Total Area</span>
<span class="co">#&gt; [1,]                  60               127             501        254</span>
<span class="co">#&gt;      Area Sampled</span>
<span class="co">#&gt; [1,]          120</span></code></pre></div>
<p><img src="my-vignette_files/figure-html/unnamed-chunk-22-1.png" width="700"><img src="my-vignette_files/figure-html/unnamed-chunk-22-2.png" width="700"></p>
<p>We can also predict the population total, fitting a covariance model for the high and low strata separately using <code>multistrat</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multiobjsightability &lt;-<span class="st"> </span><span class="kw"><a href="../reference/multistrat.html">multistrat</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
  <span class="dt">data =</span> simdf,
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>, <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">stratcol =</span> <span class="st">"Stratum"</span>,
  <span class="dt">detectionobj =</span> sightability_info)</code></pre></div>
<p>We can obtain an html report as well as the data set with site-by-site predictions using the same functions as when we assumed perfect detection and constant detection:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_reportdoc.html">get_reportdoc</a></span>(output_sightability)
output_sightability<span class="op">$</span>predvals

<span class="kw"><a href="../reference/get_reportdoc.html">get_reportdoc</a></span>(multiobjsightability)
multiobjsightability<span class="op">$</span>predvals</code></pre></div>
<hr>
<div id="predicting-for-a-quantity-other-than-the-population-total" class="section level4">
<h4 class="hasAnchor">
<a href="#predicting-for-a-quantity-other-than-the-population-total" class="anchor"></a>Predicting for a Quantity Other than the Population Total</h4>
<p>Be default, the functions within this package assume that the goal is to predict the population total across all sites in the data set specified in <code>data</code>. Another goal that managers might have is to predict the total in a specific section of the larger study area (for example, a game management unit). In order to predict a quantity other than the total, the user must specify the name of the column in the data set that has the desired prediction weights. A <code>1</code> or <code>TRUE</code> in the prediciton weight column corresponds to a site that should be included in the prediction while a <code>0</code> or <code>FALSE</code> corresponds to a site that should not be included in the prediction. For example, in the <code>simdf</code> data set, the ID numbers assigned to the 400 sites are 1 through 400. These ID numbers are given in column <code>X</code> of the data set. Suppose that I just want to predict the population total for sites 1 through 100. Then, I could define a new column in the data set as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simdf<span class="op">$</span>predwts &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(simdf<span class="op">$</span>X <span class="op">&lt;=</span><span class="st"> </span><span class="dv">100</span>)
pander<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span>(simdf[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"X"</span>, <span class="st">"Moose"</span>, <span class="st">"predwts"</span>)])</code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="11%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">X</th>
<th align="center">Moose</th>
<th align="center">predwts</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">127</td>
<td align="center">9</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">76</td>
<td align="center">23</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">78</td>
<td align="center">NA</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">20</td>
<td align="center">NA</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">219</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">48</td>
<td align="center">NA</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">96</td>
<td align="center">NA</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>Notice how any site with an ID number less than or equal to 100 has a <code>1</code> in the <code>predwts</code> column.</p>
<p>Then, in the <code>predict</code> function, I would include the <code>FPBKcol</code> argument and give the name of the column with the prediction weights. In the example below, stratum is included as a covariate in the linear model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">slmobj_predwts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slmfit.html">slmfit</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span>Stratum,
  <span class="dt">data =</span> simdf,
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>,
  <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">CorModel =</span> <span class="st">"Exponential"</span>,
  <span class="dt">estmethod =</span> <span class="st">"ML"</span>,
  <span class="dt">areacol =</span> <span class="st">"Area"</span>,
  <span class="dt">detectionobj =</span> sightability_info)
predobj_predwts &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="dt">object =</span> slmobj_predwts,
  <span class="dt">FPBKcol =</span> <span class="st">"predwts"</span>) ## added FPBKcol argument here
predobj_predwts<span class="op">$</span>FPBK_Prediction
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 1730.832</span>
<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(predobj_predwts<span class="op">$</span>PredVar)
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 211.0285</span>
output_predwts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FPBKoutput.html">FPBKoutput</a></span>(predobj_predwts)
<span class="co">#&gt;      Prediction SE(Prediction)</span>
<span class="co">#&gt; [1,]   1730.832       211.0285</span>
<span class="co">#&gt;      Lower Bound Upper Bound Proportion of Mean</span>
<span class="co">#&gt; 80 %        1460        2001               0.16</span>
<span class="co">#&gt; 90 %        1384        2078               0.20</span>
<span class="co">#&gt; 95 %        1317        2144               0.24</span>
<span class="co">#&gt;      Numb. Sites Sampled Total Numb. Sites Animals Counted Total Area</span>
<span class="co">#&gt; [1,]                 100               400            1011        800</span>
<span class="co">#&gt;      Area Sampled</span>
<span class="co">#&gt; [1,]          200</span></code></pre></div>
<p><img src="my-vignette_files/figure-html/unnamed-chunk-26-1.png" width="700"><img src="my-vignette_files/figure-html/unnamed-chunk-26-2.png" width="700"></p>
<p>If fitting a separate covariance model for each stratum, we would incorporate the <code>FPBKcol</code> argument in the multistrat function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multiobj_predwts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/multistrat.html">multistrat</a></span>(<span class="dt">formula =</span> Moose <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
  <span class="dt">data =</span> simdf,
  <span class="dt">xcoordcol =</span> <span class="st">"Xcoords"</span>, <span class="dt">ycoordcol =</span> <span class="st">"Ycoords"</span>,
  <span class="dt">stratcol =</span> <span class="st">"Stratum"</span>,
  <span class="dt">detectionobj =</span> sightability_info,
  <span class="dt">FPBKcol =</span> <span class="st">"predwts"</span>)</code></pre></div>
<p>The resulting prediction and standard error are then associated with the region of interest. We can again obtain a data frame with site-by-site predictions as well as an html report specifying the <code>$predvals</code> output to <code>multiobj_predwts</code> or <code>output_predwts</code> and using the <code>get_reportdoc</code> function.</p>
<hr>
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>We have used the <code>FPBKPack2</code> to predict the moose population total in the Togiak National Wildlife Refuge with the four main functions <code>slmfit</code>, <code>predict</code>, <code>FPBKoutput</code>, and <code>multistrat</code>. Both the structure of the data needed to be input into the functions and the output report constructed from using the functions are meant to be similar to the WinfoNet input and output.</p>
<p>(<a href="https://github.com/highamm/FPBKPack2">Link to Github Page</a>)</p>
<!-- Extra code for a different data set: -->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#section-1-perfect-detection">Section 1: Perfect Detection</a></li>
      <li><a href="#section-2-constant-detection-across-sites">Section 2: Constant Detection Across Sites</a></li>
      <li><a href="#section-3-estimating-detection-using-logistic-regression-on-radiocollar-data">Section 3: Estimating Detection Using Logistic Regression on Radiocollar Data</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Higham Matt, Ver Hoef Jay, Madsen Lisa.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
